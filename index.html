<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Mega Sena Pro</title>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-card: #ffffff;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --accent-color: #0d6efd;
            --accent-hover: #0b5ed7;
            --success-color: #198754;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-card: #242424;
            --text-primary: #e9ecef;
            --text-secondary: #adb5bd;
            --border-color: #495057;
            --shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .theme-toggle {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 25px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            color: var(--text-primary);
        }

        .tab-btn.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--bg-card);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .card h2 {
            margin-bottom: 20px;
            color: var(--accent-color);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        select, textarea, input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        /* Estilo espec√≠fico para input file */
        input[type="file"] {
            width: 100%;
            padding: 15px;
            border: 2px dashed var(--accent-color);
            border-radius: 8px;
            background: var(--bg-secondary);
            cursor: pointer;
            text-align: center;
        }

        select:focus, textarea:focus, input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        textarea {
            min-height: 150px;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }

        .btn {
            padding: 12px 24px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(13, 110, 253, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-success {
            background: var(--success-color);
        }

        .btn-success:hover {
            background: #157347;
        }

        .numbers-display {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 25px 0;
        }

        .number-ball {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            animation: popIn 0.5s ease;
        }

        @keyframes popIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .info-box {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid var(--accent-color);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-color);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .result-item {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid var(--accent-color);
        }

        .result-item.unique {
            border-left-color: var(--success-color);
        }

        .result-item.duplicate {
            border-left-color: var(--danger-color);
        }

        .ranking {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .rank-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 8px;
        }

        .rank-medal {
            font-size: 1.5rem;
            margin-right: 10px;
        }

        .progress-bar {
            height: 8px;
            background: var(--bg-primary); /* Ajustado para contraste */
            border: 1px solid var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--success-color));
            transition: width 0.5s ease;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .help-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 10px 0;
        }

        input[type="checkbox"] {
            width: auto;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }
            .number-ball {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé∞ Simulador Mega Sena Pro</h1>
            <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('generator')">üé≤ Gerador</button>
            <button class="tab-btn" onclick="switchTab('analyzer')">üìä Analisador</button>
            <button class="tab-btn" onclick="switchTab('stats')">üìà Estat√≠sticas</button>
        </div>

        <!-- TAB: GERADOR -->
        <div id="generator" class="tab-content active">
            <div class="card">
                <h2>Gerador de Combina√ß√µes √önicas</h2>
                
                <div class="form-group">
                    <label>Estrat√©gia de Gera√ß√£o:</label>
                    <select id="strategy">
                        <option value="avoid_history">üö´ Evitar Hist√≥rico (100% √önico)</option>
                        <option value="least_drawn">üìâ Dezenas Menos Sorteadas (Piso)</option>
                        <option value="most_drawn">üìà Dezenas Mais Sorteadas (Teto)</option>
                        <option value="balanced">‚öñÔ∏è Balanceada (Mix de frequ√™ncias)</option>
                        <option value="fibonacci">üî¢ Sequ√™ncia Fibonacci</option>
                        <option value="prime">üî¥ N√∫meros Primos</option>
                        <option value="hot_cold">üî•‚ùÑÔ∏è Quentes e Frios (50/50)</option>
                        <option value="random_weighted">üé≤ Aleat√≥rio Ponderado</option>
                    </select>
                    <p class="help-text" id="strategyHelp">Selecione uma estrat√©gia para ver a descri√ß√£o</p>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="avoidConsecutive">
                    <label for="avoidConsecutive">Evitar n√∫meros consecutivos</label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="balanceOddEven">
                    <label for="balanceOddEven">Balancear pares/√≠mpares (3/3 ou 4/2)</label>
                </div>

                <button class="btn btn-success" onclick="generateNumbers()">‚ú® Gerar Combina√ß√£o</button>

                <div id="generatedResult"></div>
            </div>
        </div>

        <!-- TAB: ANALISADOR -->
        <div id="analyzer" class="tab-content">
            <div class="card">
                <h2>Analisador de Jogos (Unicidade Din√¢mica)</h2>
                
                <div class="form-group">
                    <label>Insira os jogos (um por linha):</label>
                    <textarea id="gamesInput" placeholder="JOAO 05 12 23 34 45 56
MARIA 01 10 20 30 40 50
PEDRO 07 14 21 28 35 42"></textarea>
                    <p class="help-text">Formato: NOME numero1 numero2 numero3 numero4 numero5 numero6</p>
                </div>

                <button class="btn" onclick="analyzeGames()">üîç Analisar Jogos</button>

                <div id="analysisResult"></div>
            </div>
        </div>

        <!-- TAB: ESTAT√çSTICAS -->
        <div id="stats" class="tab-content">
            <div class="card">
                <h2>Estat√≠sticas Globais e Upload</h2>
                <!-- √Årea din√¢mica de status -->
                <div id="statsContent" class="loading">Carregando estat√≠sticas...</div>
            </div>
        </div>
    </div>

    <script>
        let historicalData = [];
        let numberFrequency = {};
        let minFreq = 0;
        let maxFreq = 0;

        // ------------------------------------------------------------------
        // SISTEMA DE CARREGAMENTO DE DADOS (ROBUSTO COM FALLBACK)
        // ------------------------------------------------------------------

        async function loadHistoricalData() {
            const fileName = 'Todos os resultados da Mega Sena  Rede Loteria.txt';
            
            try {
                let response;
                try {
                    // Tenta carregar automaticamente usando encodeURI para caracteres especiais
                    response = await fetch(encodeURI(fileName));
                } catch (networkError) {
                    throw new Error("Falha na requisi√ß√£o (bloqueio de navegador ou arquivo inexistente).");
                }

                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }

                const text = await response.text();
                processData(text);
                
            } catch (error) {
                console.warn("Carregamento autom√°tico falhou. Ativando modo manual.", error);
                showManualUploadUI();
            }
        }

        function showManualUploadUI() {
            const html = `
                <div class="info-box" style="border-left-color: var(--warning-color); background-color: var(--bg-secondary);">
                    <h3>‚ö†Ô∏è Arquivo de Dados Necess√°rio</h3>
                    <p>Devido √†s restri√ß√µes de seguran√ßa do navegador, o simulador n√£o conseguiu ler o arquivo local automaticamente.</p>
                    <p style="margin: 15px 0; font-weight: bold;">Por favor, selecione o arquivo manualmente abaixo:</p>
                    
                    <div style="margin: 20px 0;">
                        <input type="file" id="fileInput" accept=".txt,.csv" onchange="handleFileUpload(this)">
                    </div>
                    
                    <p class="help-text">Selecione o arquivo "Todos os resultados da Mega Sena..." que voc√™ baixou.</p>
                </div>
            `;
            document.getElementById('statsContent').innerHTML = html;
        }

        function handleFileUpload(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                processData(e.target.result);
                // Feedback visual
                alert('Dados carregados com sucesso! Agora voc√™ pode gerar jogos.');
            };
            reader.readAsText(file);
        }

        function processData(text) {
            const lines = text.split('\n');
            historicalData = [];
            numberFrequency = {};
            
            // Inicializa contadores
            for (let i = 1; i <= 60; i++) {
                numberFrequency[i] = 0;
            }
            
            lines.forEach((line, index) => {
                if (index === 0 || !line.trim()) return; // Pula cabe√ßalho ou linhas vazias
                
                // Parser flex√≠vel para lidar com diferentes separadores (v√≠rgula, tab, ponto e v√≠rgula)
                const parts = line.split(/[\t,;]+/); 
                
                // Tenta extrair n√∫meros v√°lidos
                const validNumbers = parts
                    .map(p => parseInt(p.trim()))
                    .filter(n => !isNaN(n) && n >= 1 && n <= 60);

                // Heur√≠stica: Se encontrar >= 6 n√∫meros na linha, tenta identificar as dezenas
                if (validNumbers.length >= 6) {
                    // Fallback para a estrutura original do arquivo se poss√≠vel (colunas fixas)
                    const partsOriginal = line.split(',');
                    let numbers = [];

                    if (partsOriginal.length >= 8) {
                        // Tenta pegar colunas fixas (ajustar √≠ndices conforme CSV real, aqui assume 2 a 7)
                        const cols = [2,3,4,5,6,7].map(idx => parseInt(partsOriginal[idx]));
                        if (cols.every(n => !isNaN(n))) {
                            numbers = cols.sort((a,b)=>a-b);
                        } else {
                            // Se falhar, pega os primeiros 6 n√∫meros v√°lidos encontrados
                            numbers = validNumbers.slice(0, 6).sort((a,b)=>a-b);
                        }
                    } else {
                        numbers = validNumbers.slice(0, 6).sort((a,b)=>a-b);
                    }
                    
                    // Valida se s√£o √∫nicos e dentro do range
                    if (numbers.length === 6 && new Set(numbers).size === 6) {
                        historicalData.push(numbers);
                        numbers.forEach(n => numberFrequency[n]++);
                    }
                }
            });

            // RECALIBRAGEM DIN√ÇMICA (A M√°gica do Score)
            if (historicalData.length > 0) {
                const frequencies = Object.values(numberFrequency);
                minFreq = Math.min(...frequencies);
                maxFreq = Math.max(...frequencies);
                updateStats();
                
                // Mensagem de sucesso na aba Generator se estiver vazia
                const genRes = document.getElementById('generatedResult');
                if (!genRes.innerHTML) {
                    genRes.innerHTML = `<div class="info-box" style="border-left-color: var(--success-color)">Base de dados pronta: ${historicalData.length} concursos carregados.</div>`;
                }
            } else {
                alert('Erro: O arquivo parece n√£o conter dados v√°lidos da Mega Sena.');
            }
        }

        // ------------------------------------------------------------------
        // L√ìGICA DE UNICIDADE DIN√ÇMICA
        // ------------------------------------------------------------------

        function calculateUniqueness(numbers) {
            // 1. Verifica√ß√£o Bin√°ria Absoluta (Se j√° saiu, √© zero)
            const sorted = [...numbers].sort((a, b) => a - b);
            const exists = historicalData.some(combo => 
                combo.every((n, i) => n === sorted[i])
            );
            if (exists) return 0;

            // 2. C√°lculo Relativo Din√¢mico
            // Quanto mais pr√≥xima a frequ√™ncia m√©dia estiver do PISO (minFreq), maior o score.
            const avgFreq = numbers.reduce((sum, n) => sum + (numberFrequency[n] || 0), 0) / 6;
            
            // Evita divis√£o por zero se banco for pequeno
            const range = maxFreq - minFreq || 1; 
            
            // F√≥rmula: Inverte a escala.
            // Se avgFreq == minFreq (o mais raro poss√≠vel), score = 100.
            // Se avgFreq == maxFreq (o mais comum poss√≠vel), score = 0.
            let score = 100 * (1 - (avgFreq - minFreq) / range);
            
            return Math.max(0, Math.min(100, score));
        }

        // ------------------------------------------------------------------
        // ESTRAT√âGIAS DE GERA√á√ÉO (TODAS AS ORIGINAIS RESTAURADAS)
        // ------------------------------------------------------------------

        function generateNumbers() {
            if (historicalData.length === 0) {
                alert('Por favor, carregue os dados na aba "Estat√≠sticas" primeiro.');
                switchTab('stats');
                return;
            }

            const strategy = document.getElementById('strategy').value;
            const avoidConsecutive = document.getElementById('avoidConsecutive').checked;
            const balanceOddEven = document.getElementById('balanceOddEven').checked;
            
            let numbers = [];
            let attempts = 0;
            const maxAttempts = 10000;
            
            while (attempts < maxAttempts) {
                numbers = generateByStrategy(strategy);
                
                if (avoidConsecutive && hasConsecutive(numbers)) {
                    attempts++;
                    continue;
                }
                
                if (balanceOddEven && !isBalanced(numbers)) {
                    attempts++;
                    continue;
                }
                
                // Filtro de Qualidade de Unicidade
                // Aceita qualquer score se a estrat√©gia for propositalmente "most_drawn"
                // Para outras, tenta buscar algo com unicidade razo√°vel (>20%)
                const score = calculateUniqueness(numbers);
                if (strategy !== 'most_drawn' && score < 20) {
                     attempts++;
                     continue;
                }
                
                // Garante que n√£o repete hist√≥rico (mesmo que estrat√©gia n√£o seja avoid_history)
                if (!combinationExists(numbers)) {
                    break;
                }
                attempts++;
            }
            
            if (attempts >= maxAttempts) {
                alert('N√£o foi poss√≠vel gerar uma combina√ß√£o com os filtros atuais. Tente relaxar as restri√ß√µes.');
                return;
            }
            
            displayGenerated(numbers, strategy);
        }

        function generateByStrategy(strategy) {
            let numbers = [];
            switch(strategy) {
                case 'avoid_history':
                    numbers = generateRandom();
                    break;
                case 'least_drawn':
                    numbers = generateLeastDrawn();
                    break;
                case 'most_drawn':
                    numbers = generateMostDrawn();
                    break;
                case 'balanced':
                    numbers = generateBalanced();
                    break;
                case 'fibonacci':
                    numbers = generateFibonacci();
                    break;
                case 'prime':
                    numbers = generatePrime();
                    break;
                case 'hot_cold':
                    numbers = generateHotCold();
                    break;
                case 'random_weighted':
                    numbers = generateWeighted();
                    break;
                default:
                    numbers = generateRandom();
            }
            return numbers.sort((a, b) => a - b);
        }

        // Fun√ß√µes auxiliares de gera√ß√£o
        function generateRandom() {
            const numbers = new Set();
            while (numbers.size < 6) numbers.add(Math.floor(Math.random() * 60) + 1);
            return Array.from(numbers);
        }

        function generateLeastDrawn() {
            // Prioriza n√∫meros pr√≥ximos ao minFreq
            const sorted = Object.entries(numberFrequency)
                .sort((a, b) => a[1] - b[1])
                .map(e => parseInt(e[0]));
            
            const numbers = new Set();
            const pool = sorted.slice(0, 25); // Pega os 25 menos sorteados
            
            while(numbers.size < 5) numbers.add(pool[Math.floor(Math.random() * pool.length)]);
            while(numbers.size < 6) numbers.add(Math.floor(Math.random() * 60) + 1); // 1 aleat√≥rio puro
            return Array.from(numbers);
        }

        function generateMostDrawn() {
            // Prioriza n√∫meros pr√≥ximos ao maxFreq
            const sorted = Object.entries(numberFrequency)
                .sort((a, b) => b[1] - a[1])
                .map(e => parseInt(e[0]));
            
            const numbers = new Set();
            const pool = sorted.slice(0, 25);
            while(numbers.size < 5) numbers.add(pool[Math.floor(Math.random() * pool.length)]);
            while(numbers.size < 6) numbers.add(Math.floor(Math.random() * 60) + 1);
            return Array.from(numbers);
        }

        function generateBalanced() {
            // Pega do meio da tabela
            const sorted = Object.entries(numberFrequency)
                .sort((a, b) => a[1] - b[1])
                .map(e => parseInt(e[0]));
            
            const numbers = new Set();
            const mid = Math.floor(sorted.length / 2);
            // Pool de 30 n√∫meros do meio
            const pool = sorted.slice(mid - 15, mid + 15);
            
            while(numbers.size < 6) numbers.add(pool[Math.floor(Math.random() * pool.length)]);
            return Array.from(numbers);
        }

        function generateFibonacci() {
            const fib = [1, 2, 3, 5, 8, 13, 21, 34, 55];
            const numbers = new Set();
            
            // Tenta colocar 4 numeros de fibonacci
            while(numbers.size < 4) {
                 numbers.add(fib[Math.floor(Math.random() * fib.length)]);
            }
            // Completa com aleat√≥rios
            while (numbers.size < 6) numbers.add(Math.floor(Math.random() * 60) + 1);
            return Array.from(numbers);
        }

        function generatePrime() {
            const primes = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59];
            const numbers = new Set();
            while (numbers.size < 4) numbers.add(primes[Math.floor(Math.random() * primes.length)]);
            while (numbers.size < 6) numbers.add(Math.floor(Math.random() * 60) + 1);
            return Array.from(numbers);
        }

        function generateHotCold() {
            const sorted = Object.entries(numberFrequency).sort((a, b) => b[1] - a[1]).map(e => parseInt(e[0]));
            const numbers = new Set();
            
            // 3 Quentes (Top 15)
            while(numbers.size < 3) numbers.add(sorted[Math.floor(Math.random() * 15)]);
            // 3 Frios (Bottom 15)
            while(numbers.size < 6) numbers.add(sorted[sorted.length - 1 - Math.floor(Math.random() * 15)]);
            
            return Array.from(numbers);
        }

        function generateWeighted() {
            const numbers = new Set();
            // L√≥gica de roleta viciada baseada na frequ√™ncia
            const total = Object.values(numberFrequency).reduce((a, b) => a + b, 0);
            
            while (numbers.size < 6) {
                let rand = Math.random() * total;
                let sum = 0;
                for (let [num, freq] of Object.entries(numberFrequency)) {
                    sum += freq;
                    if (rand <= sum) {
                        numbers.add(parseInt(num));
                        break;
                    }
                }
            }
            return Array.from(numbers);
        }

        function combinationExists(numbers) {
            const sorted = [...numbers].sort((a, b) => a - b);
            return historicalData.some(combo => 
                combo.every((n, i) => n === sorted[i])
            );
        }

        function hasConsecutive(numbers) {
            const sorted = [...numbers].sort((a, b) => a - b);
            for (let i = 0; i < sorted.length - 1; i++) {
                if (sorted[i + 1] - sorted[i] === 1) return true;
            }
            return false;
        }

        function isBalanced(numbers) {
            const odd = numbers.filter(n => n % 2 === 1).length;
            return odd >= 2 && odd <= 4;
        }

        // ------------------------------------------------------------------
        // EXIBI√á√ÉO E AN√ÅLISE
        // ------------------------------------------------------------------

        function displayGenerated(numbers, strategy) {
            const score = calculateUniqueness(numbers);
            const freqs = numbers.map(n => numberFrequency[n] || 0);
            
            const strategyNames = {
                'avoid_history': 'üö´ Evitar Hist√≥rico',
                'least_drawn': 'üìâ Dezenas Menos Sorteadas',
                'most_drawn': 'üìà Dezenas Mais Sorteadas',
                'balanced': '‚öñÔ∏è Balanceada',
                'fibonacci': 'üî¢ Fibonacci',
                'prime': 'üî¥ N√∫meros Primos',
                'hot_cold': 'üî•‚ùÑÔ∏è Quentes e Frios',
                'random_weighted': 'üé≤ Aleat√≥rio Ponderado'
            };
            
            const html = `
                <div class="info-box" style="margin-top: 30px;">
                    <h3>‚úÖ Combina√ß√£o Gerada</h3>
                    <p><strong>Estrat√©gia:</strong> ${strategyNames[strategy]}</p>
                    <p><strong>Unicidade Din√¢mica:</strong> ${score.toFixed(1)}%</p>
                    <small>Intervalo Base: ${minFreq} - ${maxFreq} sa√≠das</small>
                </div>
                
                <div class="numbers-display">
                    ${numbers.map((n, i) => `
                        <div class="number-ball" style="animation-delay: ${i * 0.1}s">
                            ${String(n).padStart(2, '0')}
                        </div>
                    `).join('')}
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${numbers.filter(n => n % 2 === 1).length}</div>
                        <div class="stat-label">√çmpares</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${numbers.filter(n => n % 2 === 0).length}</div>
                        <div class="stat-label">Pares</div>
                    </div>
                </div>
            `;
            
            document.getElementById('generatedResult').innerHTML = html;
        }

        function analyzeGames() {
            if(historicalData.length === 0) {
                alert('Carregue os dados primeiro.');
                switchTab('stats');
                return;
            }

            const input = document.getElementById('gamesInput').value.trim();
            if (!input) {
                alert('Por favor, insira pelo menos um jogo.');
                return;
            }
            
            const lines = input.split('\n').filter(l => l.trim());
            const results = [];
            
            lines.forEach(line => {
                const parts = line.trim().split(/[\s,.-]+/);
                const name = isNaN(parseInt(parts[0])) ? parts[0] : "Jogo";
                
                const numbers = parts
                    .map(n => parseInt(n))
                    .filter(n => !isNaN(n) && n >= 1 && n <= 60)
                    .slice(0, 6) // Pega os 6 primeiros v√°lidos
                    .sort((a, b) => a - b);
                
                if (numbers.length !== 6) return;
                
                const isDuplicate = combinationExists(numbers);
                const freqs = numbers.map(n => numberFrequency[n] || 0);
                const totalFreq = freqs.reduce((a, b) => a + b, 0);
                const avgFreq = totalFreq / 6;
                const uniquenessScore = calculateUniqueness(numbers);
                
                // Vari√¢ncia
                const variance = freqs.reduce((sum, f) => sum + Math.pow(f - avgFreq, 2), 0) / 6;
                
                results.push({
                    name,
                    numbers,
                    isDuplicate,
                    freqs,
                    totalFreq,
                    avgFreq,
                    variance,
                    uniquenessScore
                });
            });
            
            displayAnalysis(results);
        }

        function displayAnalysis(results) {
            results.sort((a, b) => b.uniquenessScore - a.uniquenessScore);
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            
            let html = '<h3>üìä Resultados da An√°lise</h3><div class="ranking">';
            
            results.forEach((result, index) => {
                const medal = index < 3 ? medals[index] : `${index + 1}¬∫`;
                const statusClass = result.isDuplicate ? 'duplicate' : 'unique';
                const statusText = result.isDuplicate ? '‚ùå J√Å SORTEADO' : '‚úÖ √öNICO';
                
                // Cor da barra baseada no score din√¢mico
                const scoreColor = result.uniquenessScore > 75 ? 'var(--success-color)' : 
                                 result.uniquenessScore < 30 ? 'var(--danger-color)' : 'var(--warning-color)';

                html += `
                    <div class="result-item ${statusClass}">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4><span class="rank-medal">${medal}</span>${result.name}</h4>
                            <span style="font-weight: bold; color: ${result.isDuplicate ? 'var(--danger-color)' : 'var(--success-color)'};">
                                ${statusText}
                            </span>
                        </div>
                        
                        <div class="numbers-display" style="justify-content: flex-start; margin: 15px 0;">
                            ${result.numbers.map(n => `
                                <div class="number-ball" style="width: 50px; height: 50px; font-size: 1.2rem;">
                                    ${String(n).padStart(2, '0')}
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" style="color:${scoreColor}">${result.uniquenessScore.toFixed(1)}%</div>
                                <div class="stat-label">Unicidade</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${result.avgFreq.toFixed(0)}</div>
                                <div class="stat-label">M√©dia Sa√≠das</div>
                            </div>
                        </div>
                        
                        <div class="info-box">
                            <h4>Frequ√™ncia Individual (vs M√°x ${maxFreq}):</h4>
                            ${result.numbers.map((n, i) => `
                                <div style="margin-bottom:5px">
                                    <div style="display:flex; justify-content:space-between">
                                        <strong>${String(n).padStart(2, '0')}</strong>
                                        <span>${result.freqs[i]} sa√≠das</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${(result.freqs[i] / maxFreq) * 100}%"></div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            document.getElementById('analysisResult').innerHTML = html;
        }

        // ------------------------------------------------------------------
        // ESTAT√çSTICAS E UI
        // ------------------------------------------------------------------

        function updateStats() {
            const sorted = Object.entries(numberFrequency).sort((a, b) => b[1] - a[1]);
            const top10 = sorted.slice(0, 10);
            const bottom10 = sorted.slice(-10).reverse();
            
            const html = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${historicalData.length}</div>
                        <div class="stat-label">Sorteios</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${maxFreq}</div>
                        <div class="stat-label">Teto (Max)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${minFreq}</div>
                        <div class="stat-label">Piso (Min)</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>üî• Top 10 - Mais Sorteados (Teto)</h3>
                    ${top10.map((entry, i) => `
                        <div class="rank-item">
                            <div>
                                <span class="rank-medal">${i < 3 ? ['ü•á','ü•à','ü•â'][i] : `${i+1}¬∫`}</span>
                                <strong>N√∫mero ${String(entry[0]).padStart(2, '0')}</strong>
                            </div>
                            <div>
                                <strong>${entry[1]}</strong>
                                <div class="progress-bar" style="width: 150px; display:inline-block; margin-left:10px; vertical-align:middle">
                                    <div class="progress-fill" style="width: ${(entry[1] / maxFreq) * 100}%"></div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div class="card">
                    <h3>‚ùÑÔ∏è Top 10 - Menos Sorteados (Piso)</h3>
                    ${bottom10.map((entry, i) => `
                        <div class="rank-item">
                            <div>
                                <span class="rank-medal">${i+1}¬∫</span>
                                <strong>N√∫mero ${String(entry[0]).padStart(2, '0')}</strong>
                            </div>
                            <div>
                                <strong>${entry[1]}</strong>
                                <div class="progress-bar" style="width: 150px; display:inline-block; margin-left:10px; vertical-align:middle">
                                    <div class="progress-fill" style="width: ${(entry[1] / maxFreq) * 100}%"></div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('statsContent').innerHTML = html;
        }

        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        document.getElementById('strategy').addEventListener('change', function(e) {
            const descriptions = {
                'avoid_history': 'Gera n√∫meros aleat√≥rios, validando apenas se j√° sa√≠ram juntos.',
                'least_drawn': 'Prioriza os n√∫meros mais pr√≥ximos do piso (menos sorteados).',
                'most_drawn': 'Prioriza os n√∫meros mais pr√≥ximos do teto (mais sorteados).',
                'balanced': 'Pega n√∫meros com frequ√™ncia mediana para equilibrar.',
                'fibonacci': 'Tenta usar n√∫meros da sequ√™ncia Fibonacci (1,2,3,5,8...).',
                'prime': 'Prioriza o uso de n√∫meros primos.',
                'hot_cold': 'Mistura 50% de n√∫meros quentes (teto) e 50% frios (piso).',
                'random_weighted': 'Roleta viciada: n√∫meros que sa√≠ram mais t√™m mais chance.'
            };
            document.getElementById('strategyHelp').textContent = descriptions[e.target.value] || '';
        });

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            loadHistoricalData();
            document.getElementById('strategy').dispatchEvent(new Event('change'));
        });
    </script>
</body>
</html>
